{% extends 'reports/base_pdf.html' %} 
{% load static %}

{% block title %}Ficha Cadastral - {{ employee.name }}{% endblock %}

{% block header_title %}Ficha Cadastral{% endblock %}

{% block style %}
    .section-title {
        font-size: 0.65rem;
        font-weight: bold;
        color: #fff;
        background-color: #a3a3a3;
        padding: 0.33rem 0.53rem;
        border-radius: 4px 4px 0 0;
        margin-top: 0.97rem;
        text-transform: uppercase;
        border: 1px solid #a3a3a3;
        page-break-after: avoid;
        break-after: avoid;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #999;
        border-top: none;
        table-layout: fixed; /* Garante que as colunas respeitem as larguras */
    }
    
    .data-table td {
        border: 1px solid #999;
        padding: 0.33rem 0.53rem;
        vertical-align: top;
        word-wrap: break-word; /* Evita texto vazando da célula */
    }
    
    .data-table strong {
        display: block;
        font-size: 0.46rem;
        color: #666;
        text-transform: uppercase;
        margin-bottom: 0.13rem;
        font-weight: bold;
    }
    
    .data-table span {
        font-size: 0.65rem;
        color: #000;
        display: block;
        min-height: 0.92rem;
    }

    .active-tag {
        display: inline-block;
        width: auto; 
        background-color: #f0f0f0; 
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 0.13rem 0.4rem;
        margin-right: 0.33rem;       
        margin-bottom: 0.13rem;
        font-size: 0.53rem;         
        color: #333;
        font-weight: bold;
        white-space: nowrap;     
        line-height: 1;          
    }

    .related-table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #999;
        border-top: none;
    }
    .related-table th {
        background-color: #f2f2f2;
        border: 1px solid #999;
        padding: 0.33rem;
        font-size: 0.53rem;
        text-transform: uppercase;
        text-align: left;
    }
    .related-table td {
        border: 1px solid #999;
        padding: 0.33rem;
        font-size: 0.59rem;
    }
{% endblock %}

{% block content %}

    <div class="section-title">Dados Pessoais</div>
    <table class="data-table">
        <tr>
            <td colspan="2" width="66%">
                <strong>Nome Completo</strong>
                <span>{{ employee.name|default:"-"|upper }}</span>
            </td>
            <td width="34%">
                <strong>Matrícula</strong>
                <span>{{ employee.registration_number|default:"-" }}</span>
            </td>
        </tr>
        <tr>
            <td width="33%">
                <strong>CPF</strong>
                <span>{{ employee.cpf|default:"-" }}</span>
            </td>
            <td width="33%">
                <strong>Data de Nascimento</strong>
                <span>{{ employee.birth_date|date:"d/m/Y"|default:"-" }}</span>
            </td>
            <td width="34%">
                <strong>Gênero</strong>
                <span>{{ employee.get_gender_display|default:"-" }}</span>
            </td>
        </tr>
        <tr>
            <td>
                <strong>Escolaridade</strong>
                <span>{{ employee.get_education_level_display|default:"-" }}</span>
            </td>
            <td>
                <strong>Estado Civil</strong>
                <span>{{ employee.get_marital_status_display|default:"-" }}</span>
            </td>
            <td>
                <strong>Etnia/Raça</strong>
                <span>{{ employee.get_ethnicity_display|default:"-" }}</span>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <strong>Nome da Mãe</strong>
                <span>{{ employee.mother_name|default:"-"|upper }}</span>
            </td>
            <td>
                <strong>Aposentadoria</strong>
                <span>{{ employee.get_retirement_status_display|default:"-" }}</span>
            </td>
        </tr>
        <tr>
            <td>
                <strong>Naturalidade (Cidade)</strong>
                <span>{{ employee.birth_city|default:"-" }}</span>
            </td>
            <td colspan="2">
                <strong>UF Nascimento</strong>
                <span>{{ employee.get_state_birthplace_code_display|default:employee.state_birthplace_code|default:"-" }}</span>
            </td>
        </tr>
    </table>

    <div class="section-title">Documentação</div>
    <table class="data-table">
        <tr>
            <td width="25%">
                <strong>RG</strong>
                <span>{{ employee.rg|default:"-" }}</span>
            </td>
            <td width="25%">
                <strong>Emissão RG</strong>
                <span>{{ employee.rg_issue_date|date:"d/m/Y"|default:"-" }}</span>
            </td>
            <td width="25%">
                <strong>PIS</strong>
                <span>{{ employee.pis|default:"-" }}</span>
            </td>
            <td width="25%">
                <strong>Emissão CTPS</strong>
                <span>{{ employee.ctps_issue_date|date:"d/m/Y"|default:"-" }}</span>
            </td>
        </tr>
        <tr>
            <td>
                <strong>CTPS (Número)</strong>
                <span>{{ employee.ctps_number|default:"-" }}</span>
            </td>
            <td>
                <strong>CTPS (Série)</strong>
                <span>{{ employee.ctps_series|default:"-" }}</span>
            </td>
            
            <td colspan="2">
                <strong>Estrangeiro (Dados RNE)</strong>
                
                {% if employee.is_foreign %}
                    <div style="font-size: 8pt; margin-top: 3px; line-height: 1.4;">
                        <div style="margin-bottom: 3px;">
                            <span style="display:inline; font-weight:bold;">RNE:</span> {{ employee.rne_number|default:"-" }} 
                            &nbsp;|&nbsp; 
                            <span style="display:inline; font-weight:bold;">Org.:</span> {{ employee.rne_issuing_authority|default:"-" }}
                            &nbsp;|&nbsp; 
                            <span style="display:inline; font-weight:bold;">Emissão:</span> {{ employee.rne_issue_date|date:"d/m/Y"|default:"-" }}
                        </div>
                        <div style="margin-bottom: 5px;">
                            <span style="display:inline; font-weight:bold;">Chegada:</span> {{ employee.arrival_date|date:"d/m/Y"|default:"-" }}
                            &nbsp;|&nbsp; 
                            <span style="display:inline; font-weight:bold;">Naturalização:</span> {{ employee.naturalization_date|date:"d/m/Y"|default:"-" }}
                        </div>
                        <div>
                            {% if employee.married_to_brazilian %}
                                <span class="active-tag">Casado(a) c/ Brasileiro</span>
                            {% endif %}
                            {% if employee.has_brazilian_children %}
                                <span class="active-tag">Tem Filhos Brasileiros</span>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <span>Não</span>
                {% endif %}
            </td>
        </tr>
    </table>

    <div class="section-title">Dados do Contrato</div>
    <table class="data-table">
        <tr>
            <td width="33%">
                <strong>Setor</strong>
                <span>{{ employee.department.name|default:"-"|upper }}</span>
            </td>
            <td width="33%">
                <strong>Cargo</strong>
                <span>{{ employee.job_title.name|default:"-"|upper }}</span>
            </td>
            <td width="34%">
                <strong>Salário Atual</strong>
                <span>R$ {{ employee.current_salary|default:"0,00" }}</span>
            </td>
        </tr>
        
        <tr>
            <td colspan="3">
                <strong>Descrição do Cargo</strong>
                <span>{{ employee.job_title.description|default:"-" }}</span>
            </td>
        </tr>

        <tr>
            <td>
                <strong>Data de Admissão</strong>
                <span>{{ employee.hire_date|date:"d/m/Y"|default:"-" }}</span>
            </td>
            <td>
                <strong>Exame Admissional</strong>
                <span>{{ employee.admission_exam_date|date:"d/m/Y"|default:"-" }}</span>
            </td>
            <td>
                <strong>Status Atual</strong>
                <span>
                    {% if employee.termination_date %}
                        DESLIGADO EM {{ employee.termination_date|date:"d/m/Y" }}
                    {% else %}
                        ATIVO
                    {% endif %}
                </span>
            </td>
        </tr>

        <tr>
            <td width="33%">
                <strong>Tipo de Jornada</strong>
                <span>{{ employee.get_workday_type_display|default:employee.workday_type|default:"-" }}</span>
            </td>
            <td width="33%">
                <strong>Jornada Especial</strong>
                <span>{{ employee.special_workday|default:"-" }}</span>
            </td>
            <td width="34%">
                <strong>Descrição Outro</strong>
                {% if employee.special_workday == 'Outro' %}
                    <span>{{ employee.special_workday_other|default:"-" }}</span>
                {% else %}
                    <span style="color: #ccc;">-</span>
                {% endif %}
            </td>
        </tr>

        <tr>
            <td colspan="3">
                <strong>Informações da Jornada (Dias, Horários e Intervalos)</strong>
                <span style="white-space: pre-wrap;">{{ employee.working_info|default:"-" }}</span>
            </td>
        </tr>

        <tr>
            <td colspan="3">
                <strong>Características do Contrato</strong>
                <div style="margin-top: 4px; display: flex; flex-wrap: wrap; gap: 4px;">
                    {% if employee.is_trial_contract %}
                        <span class="active-tag">Experiência</span>
                    {% endif %}
                    {% if employee.is_first_job %}
                        <span class="active-tag">Primeiro Emprego</span>
                    {% endif %}
                    {% if employee.is_intermittent_contract %}
                        <span class="active-tag">Intermitente</span>
                    {% endif %}
                    {% if employee.has_insalubrity_bonus %}
                        <span class="active-tag">Insalubridade</span>
                    {% endif %}
                    {% if employee.has_danger_bonus %}
                        <span class="active-tag">Periculosidade</span>
                    {% endif %}

                    {% if not employee.is_trial_contract and not employee.is_first_job and not employee.is_intermittent_contract and not employee.has_insalubrity_bonus and not employee.has_danger_bonus %}
                        <span style="font-size: 8pt; color: #999;">-</span>
                    {% endif %}
                </div>
            </td>
        </tr>
    </table>

    <div class="section-title">Dados Bancários</div>
    <table class="data-table">
        <tr>
            <td width="40%">
                <strong>Banco</strong>
                <span>{{ employee.bank_name|default:"-" }}</span>
            </td>
            <td width="20%">
                <strong>Agência</strong>
                <span>{{ employee.bank_agency_code|default:"-" }}</span>
            </td>
            <td width="20%">
                <strong>Conta</strong>
                <span>{{ employee.account_num|default:"-" }}</span>
            </td>
            <td width="20%">
                <strong>Tipo</strong>
                <span>{{ employee.account_type|default:"-" }}</span>
            </td>
        </tr>
    </table>

    <div class="section-title">Informações Adicionais</div>
    <table class="data-table">
        <tr>
            <td width="33%">
                <strong>PCD (Pessoa com Deficiência)</strong>
                <span>{% if employee.is_pcd %}SIM - {{ employee.disability_type|default:"-" }}{% else %}NÃO{% endif %}</span>
            </td>
            <td width="33%">
                <strong>Vale Transporte</strong>
                <span>{% if employee.uses_transport_voucher %}Optante{% else %}Não Optante{% endif %}</span>
            </td>
            <td width="34%">
                <strong>CIPA</strong>
                <span>
                    {% if employee.is_cipa_member %}
                        {{ employee.cipa_role }} (Fim: {{ employee.cipa_mandate_end_date|date:"d/m/Y" }})
                    {% else %}
                        Não Integrante
                    {% endif %}
                </span>
            </td>
        </tr>
    </table>

    <div class="section-title">Dependentes</div>
    <table class="related-table">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Nascimento</th>
                <th>Parentesco</th>
                <th>CPF</th>
            </tr>
        </thead>
        <tbody>
            {% for dependent in employee.dependents.all %}
            <tr>
                <td>{{ dependent.name|upper }}</td>
                <td>{{ dependent.birth_date|date:"d/m/Y" }}</td>
                <td>{{ dependent.get_relationship_type_display }}</td>
                <td>{{ dependent.cpf|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align: center; color: #666; padding: 10px;">
                    Nenhum dependente cadastrado.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="break-inside:avoid; margin-top: 2rem; border: 1px solid #000; padding: 10px; font-size: 0.7rem; text-align: justify; line-height: 1.2;">
        <strong>( &nbsp;&nbsp; ) Estou ciente da solicitação, arquivamento e uso dos dados supracitados nesta ficha de 
        registro de empregados, durante o período que durar a prestação de serviços de minha parte 
        à empresa, até mesmo após a extinção do contrato de trabalho, para cumprimento das 
        obrigações legais, tais como: sistema de folha de pagamento; sindicato da categoria; Receita 
        Federal; Ministério da Economia; Previdência Social; Caixa Econômica Federal; eSocial; 
        Empregador web; Gov.br; cumprimento do prazo de guarda de meus dados; e demais 
        obrigações que venham ser necessárias para o envio dos meus dados pessoais, até mesmo 
        sensíveis, conforme as leis governamentais, seguindo os preceitos da Lei 13.709/2018 – LGPD.</strong>
    </div>

    <div style="margin-top: 3rem; width: 100%;">
        
        <div style="float: left; width: 45%;">
            <div style="border-top: 1px solid #000; width: 100%; margin-bottom: 5px;"></div>
            <div style="font-size: 0.7rem;">Assinatura Legível do Funcionário</div>
        </div>

        <div style="clear: both; height: 1.5rem;"></div>

        <div style="float: left; width: 100%; margin-bottom: 2.5rem;">
            <span style="font-size: 0.7rem;">AUTORIZADOR POR: (RESPONSÁVEL DA EMPRESA) __________________________________________________</span>
        </div>

        <div style="width: 100%; margin-bottom: 2rem;">
            <div style="float: left; width: 30%; font-size: 0.7rem;">
                DATA: {% now "d/m/Y" %}
            </div>
            <div style="float: right; width: 45%; text-align: center;">
                <div style="border-top: 1px solid #000; width: 100%; margin-bottom: 5px;"></div>
                <div style="font-size: 0.7rem;"><strong>{{ company_name_settings }}</strong></div>
            </div>
            <div style="clear: both;"></div>
        </div>

        <table style="width: 100%; border-collapse: collapse; border: 1px solid #000; font-size: 0.6rem; line-height: 1.2;">
            <tr>
                <td style="width: 33%; border: 1px solid #000; padding: 5px; vertical-align: top; text-align: justify;">
                    <strong>Fica vossa senhoria ciente de que os exames médicos admissionais, periódicos e demissionais são obrigatórios de acordo com a CLT.</strong> 
                    A responsabilidade pela realização dos exames é vossa ou de empresa de medicina e segurança do trabalho por vossa senhoria contratada. 
                    A não realização destes exames pode trazer penalidades à empresa.
                </td>

                <td style="width: 33%; border: 1px solid #000; padding: 5px; vertical-align: top; text-align: justify;">
                    <strong>De acordo com a CLT, na jornada de 8 horas diárias o intervalo deve ser de no mínimo 1 (uma) e no máximo de 2 (duas) horas.</strong>
                </td>

                <td style="width: 34%; border: 1px solid #000; padding: 5px; vertical-align: top; text-align: justify;">
                    <strong>Segundo a Convenção Coletiva de Trabalho do Sindicato, o trabalhador tem direito a um salário base de acordo com a categoria econômica da empresa.</strong> 
                    Caso vossa senhoria pague valor a menor que este, estará propenso a eventuais problemas.<br><br>
                    ( &nbsp; ) Sindicato<br>
                    ( &nbsp; ) Outro: R$ __________________
                </td>
            </tr>
        </table>
    </div>

{% endblock %}